## Unit Testing


### Running unit tests

Unit tests are implemented using thhe [Google's C++ test framework](https://github.com/google/googletest).
The tests source files are located under the `tests` directory as test_*.cpp.

You might also add an example in the `example` directory which will be also run as a test as defined by the current cmake configuration.

After build, tests as built as a single executable at {VT_TV_BUID_DIR}/tests/unit/AllTests.

To run all the tests:
`{VT_TV_BUID_DIR}/tests/unit/AllTests`

To run a single test:
`{VT_TV_BUID_DIR}/tests/unit/AllTests --gtest_filter=ParseRenderTest`

See more options at [Google Test - Running Test Programs: Advanced Options](https://google.github.io/googletest/advanced.html#running-test-programs-advanced-options)

# Running coverage

Coverage is generated by `gcov` and coverage report can be generated by `lcov`.

1. Perform coverage (generates .gcda files):
`ctest --test-dir build -T Coverage`

1. Generate lcov file from .gcda files:

```shell
lcov --capture --directory . --output-file output/lcov_vt-tv_test.info
```

2. Remove lib, include and tests directories to cover only the source directories
```shell
lcov --remove output/lcov_vt-tv_test.info -o output/lcov_vt-tv_test_no_deps.info '*/lib/*' '/usr/include/*' '*/vtk/*' '*/tests/*'
```
3. Get report

- Basic summary or per-file coverage

```shell
lcov --summary output/lcov_vt-tv_test_no_deps.info
lcov --list output/lcov_vt-tv_test_no_deps.info
```
This mode enables to view which part of code has been hit or not hit by ctest.

```shell
genhtml --prefix ./src --ignore-errors source ./output/lcov_vt-tv_test_no_deps.info --legend --title "$(git rev-parse HEAD)" --output-directory=output/lcov_vt-tv_html
```
